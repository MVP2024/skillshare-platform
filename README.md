# SkillShare Platform Backend

![Django](https://img.shields.io/badge/Django-092E20?style=for-the-badge&logo=django&logoColor=green)
![Django REST Framework](https://img.shields.io/badge/DRF-FF1709?style=for-the-badge&logo=django&logoColor=white)
![Python](https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=python&logoColor=white)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-316192?style=for-the-badge&logo=postgresql&logoColor=white)
![Git](https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=git&logoColor=white)
![GitHub](https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white)

## Описание проекта

Этот проект представляет собой бэкенд для платформы онлайн-обучения, аналогичной SkillShare, разработанный с
использованием Django и Django REST Framework. Он предоставляет API для управления пользователями, курсами, уроками и
платежами.

### Основные возможности:

* **Управление пользователями**: Регистрация, авторизация, профили пользователей.
* **Курсы и уроки**: Создание, просмотр, обновление и удаление курсов и уроков.
* **Платежи**: Запись и отслеживание платежей за курсы и уроки.
* **Фильтрация и сортировка**: Гибкие возможности для поиска и упорядочивания платежей.
* **История платежей**: Просмотр истории платежей в профиле пользователя.

## Структура проекта

* `skillshare_platform/`: Основные настройки проекта Django, корневые URL-адреса.
* `users/`: Приложение для управления пользователями, их профилями и платежами. Содержит модели `User` и `Payment`,
  сериализаторы, представления и URL-адреса.
* `materials/`: Приложение для управления учебными материалами (курсами и уроками). Содержит модели `Course` и `Lesson`,
  сериализаторы, представления и URL-адреса.
* `media/`: Директория для хранения загружаемых пользователями файлов (аватары, превью курсов/уроков).
* `env/`, `.venv/`: Виртуальные окружения (игнорируются Git).
* `.env`, `.env.example`: Файлы для хранения переменных окружения.
* `requirements.txt`: Список всех зависимостей проекта.
* `manage.py`: Утилита командной строки Django для выполнения административных задач.

## Установка и запуск

Следуйте этим шагам, чтобы настроить и запустить проект локально.

### 1. Клонирование репозитория

```
    git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
    cd SkillShare
```

### 2. Создание и активация виртуального окружения

Рекомендуется использовать виртуальное окружение для изоляции зависимостей проекта.

Для Windows:

```
    python -m venv .venv
    .venv\Scripts\activate
```

Для macOS/Linux:

```
    python3 -m venv .venv
    source .venv/bin/activate
```

### 3. Установка зависимостей

Установите все необходимые библиотеки из requirements.txt:

```
    pip install -r requirements.txt
```

### 4. Настройка переменных окружения

Создайте файл .env в корневой директории проекта, скопировав содержимое из .env.example.
Заполните его своими данными:

.env

```
SECRET_KEY=ваша_секретная_строка_для_django
DB_NAME=название_вашей_базы_данных
DB_USER=пользователь_базы_данных
DB_PASSWORD=пароль_базы_данных
DB_HOST=хост_базы_данных (например, localhost)
DB_PORT=порт_базы_данных (например, 5432)
```

### 5. Настройка базы данных

Проект использует PostgreSQL. Убедитесь, что у вас установлен и запущен PostgreSQL,
и создайте базу данных, указанную в .env.

### 6. Выполнение миграций

После любых изменений в моделях Django необходимо создать файлы миграций,
а затем применить их для обновления структуры базы данных.

**Создание файлов миграций:**

```
    python manage.py makemigrations
```

Примените миграции для создания таблиц в базе данных:

```
    python manage.py migrate
```

### 7. Загрузка начальных данных (фикстуры)

Проект включает кастомную команду для загрузки тестовых данных (пользователей, курсов, уроков, платежей) из фикстуры
materials/fixtures/initial_data.json. Эта команда также удаляет существующие данные перед загрузкой, чтобы избежать
дублирования.

```
    python -Xutf8 manage.py load_initial_data
```

Если вы хотите загрузить фикстуру вручную (без удаления существующих данных), используйте:

```
    python -Xutf8 manage.py loaddata materials/fixtures/initial_data.json
```

Чтобы создать фикстуру с уже имеющими у Вас данными используйте это:

```
     python -Xutf8 manage.py dumpdata users.user materials.course materials.lesson users.payment --indent 4 > materials/fixtures/initial_data.json
```

### 8. Создание суперпользователя (для доступа к админ-панели)

```
    python manage.py createsuperuser
```

Следуйте инструкциям в консоли для создания учетной записи суперпользователя.

### 9. Запуск сервера разработки

```
    python manage.py runserver
```

Сервер будет доступен по адресу `http://127.0.0.1:8000/`.

# Использование API

Вы можете взаимодействовать с API с помощью инструментов, таких как Postman, Insomnia или непосредственно через браузер.

## Аутентификация (JWT)

Для получения токенов и доступа к защищенным эндпоинтам используйте следующие шаги:

1.  **Получение токенов (логин)**:
    *   **Эндпоинт**: `POST /api/token/`
    *   **Тело запроса (JSON)**:
        ```json
        {
            "email": "ваш_email",
            "password": "ваш_пароль"
        }
        ```
    *   **Ответ**: `{"refresh": "...", "access": "..."}`

2.  **Использование Access Token**:
    *   Включите `access` токен в заголовок `Authorization` для всех защищенных запросов:
        `Authorization: Bearer <ваш_access_токен>`

3.  **Обновление Access Token**:
    *   **Эндпоинт**: `POST /api/token/refresh/`
    *   **Тело запроса (JSON)**:
        ```json
        {
            "refresh": "ваш_refresh_токен"
        }
        ```
    *   **Ответ**: `{"access": "..."}`


# Админ-панель Django

Доступ к админ-панели: `http://127.0.0.1:8000/admin/`
Используйте учетные данные суперпользователя, созданные ранее, для входа.

# Основные эндпоинты API

Базовый URL для всех API-запросов: `http://127.0.0.1:8000/api/`

## Пользователи

- **Регистрация нового пользователя**: `POST /api/users/` (доступно без аутентификации)
- **Получить список пользователей**: `GET /api/users/` (требуется аутентификация)
- **Получить детали пользователя (включая платежи)**: `GET /api/users/{id}/` (требуется аутентификация)
- **Обновить свой профиль**: `PUT /api/profile/` (требуется аутентификация)

## Платежи

- **Получить список платежей**: `GET /api/payments/` (требуется аутентификация)

## Сортировка:

- **По дате оплаты (по возрастанию)**: `GET /api/payments/?ordering=payment_date`
- **По дате оплаты (по убыванию)**: `GET /api/payments/?ordering=-payment_date`

## Комбинированная фильтрация и сортировка:

- `GET /api/payments/?paid_course=1&payment_method=cash&ordering=-payment_date`

# Курсы

- **Получить список курсов**: `GET /api/courses/` (требуется аутентификация)
- **Получить детали курса (включая уроки и их количество)**: `GET /api/courses/{id}/` (требуется аутентификация)

# Уроки

- **Получить список уроков**: `GET /api/lessons/` (требуется аутентификация)
- **Получить детали урока**: `GET /api/lessons/{id}/` (требуется аутентификация)

# Пример использования в Postman

- Запустите сервер Django.
- Откройте Postman.
- Создайте новый запрос.
- Выберите метод `GET`.
- Введите URL, например: `http://127.0.0.1:8000/api/payments/?payment_method=cash&ordering=-payment_date`
- Нажмите "Send".

Вы получите JSON-ответ со списком платежей, отфильтрованных по способу оплаты "Наличные" и отсортированных по дате
оплаты в убывающем порядке.

# Заключение

Этот проект предоставляет надежную основу для создания платформы онлайн-обучения. Он демонстрирует лучшие практики
разработки на Django REST Framework, включая структурирование кода, использование сериализаторов, ViewSet'ов, фильтрации
и кастомных команд.